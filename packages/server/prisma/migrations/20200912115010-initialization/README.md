# Migration `20200912115010-initialization`

This migration has been generated by Arthur Santos at 9/12/2020, 8:50:11 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."Role" AS ENUM ('USER', 'ADMIN')

CREATE TYPE "public"."Size" AS ENUM ('SMALL', 'MEDIUM', 'LARGE')

CREATE TYPE "public"."Charge" AS ENUM ('BEAT', 'VOLUME', 'PIPE')

CREATE TYPE "public"."Receipt" AS ENUM ('MONEY', 'DEPOSIT', 'PENDING')

CREATE TYPE "public"."Freight" AS ENUM ('CIF', 'FOB')

CREATE TYPE "public"."Vehicle" AS ENUM ('EXTERNAL', 'INTERNAL')

CREATE TYPE "public"."Divergence" AS ENUM ('ADDED', 'RECEIVED', 'NOT_RECEIVED', 'RESCHEDULED')

CREATE TYPE "public"."InvoiceOrigin" AS ENUM ('SCHEDULE', 'FOLLOWUP')

CREATE TABLE "public"."users" (
"id" text   NOT NULL ,
"email" text   NOT NULL ,
"name" text   NOT NULL ,
"password" text   NOT NULL ,
"role" "Role"  NOT NULL DEFAULT E'USER',
"permissionsId" text   ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"disabledAt" timestamp(3)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."permissions" (
"id" text   NOT NULL ,
"title" text   NOT NULL ,
"accessSchedules" boolean   NOT NULL DEFAULT false,
"createRequest" boolean   NOT NULL DEFAULT false,
"createSchedule" boolean   NOT NULL DEFAULT false,
"closeSchedule" boolean   NOT NULL DEFAULT false,
"manageInvoicesInSchedule" boolean   NOT NULL DEFAULT false,
"addExtraScheduledInvoices" boolean   NOT NULL DEFAULT false,
"receiveSchedule" boolean   NOT NULL DEFAULT false,
"cancelSchedule" boolean   NOT NULL DEFAULT false,
"rescheduleSchedule" boolean   NOT NULL DEFAULT false,
"accessAccompaniments" boolean   NOT NULL DEFAULT false,
"manageAccompaniments" boolean   NOT NULL DEFAULT false,
"accessRepresentatives" boolean   NOT NULL DEFAULT false,
"viewValues" boolean   NOT NULL DEFAULT false,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."accompaniments" (
"id" text   NOT NULL ,
"number" integer   NOT NULL ,
"releasedAt" timestamp(3)   ,
"expectedBillingAt" timestamp(3)   ,
"billingAt" timestamp(3)   ,
"freeOnBoardAt" timestamp(3)   ,
"schedulingAt" timestamp(3)   ,
"valueDelivered" Decimal(65,30)   DEFAULT 0.0,
"invoiceId" text   ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."accompanimentAnnotations" (
"id" text   NOT NULL ,
"content" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"userId" text   NOT NULL ,
"accompanimentId" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."cancelations" (
"accompanimentId" text   NOT NULL ,
"motive" text   NOT NULL ,
"userId" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("accompanimentId")
)

CREATE TABLE "public"."schedules" (
"id" text   NOT NULL ,
"dischargeTableId" text   NOT NULL ,
"scheduleRequestId" text   ,
"scheduledAt" timestamp(3)   ,
"priority" boolean   NOT NULL DEFAULT false,
"shippingName" text   ,
"freightType" "Freight"  ,
"vehicleType" "Vehicle"  ,
"lecturer" text   ,
"driver" text   ,
"vehicleSize" "Size"  ,
"chargeType" "Charge"  ,
"palletized" boolean   ,
"assistant" boolean   ,
"pipeSize" "Size"  ,
"receiptPerInvoice" boolean   ,
"dischargeValue" Decimal(65,30)   ,
"receiptValue" Decimal(65,30)   ,
"paymentMethod" "Receipt"  ,
"closedAt" timestamp(3)   ,
"receivedAt" timestamp(3)   ,
"rescheduledAt" timestamp(3)   ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"canceledAt" timestamp(3)   ,
"motive" text   ,
"schedulesId" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."scheduleRequests" (
"id" text   NOT NULL ,
"requestedDate" timestamp(3)   ,
"providerCode" integer   ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."invoices" (
"id" text   NOT NULL ,
"origin" "InvoiceOrigin"  NOT NULL ,
"providerCode" integer   NOT NULL ,
"number" integer   NOT NULL ,
"value" Decimal(65,30)   ,
"emittedAt" timestamp(3)   ,
"key" text   ,
"weight" Decimal(65,30)   ,
"volume" Decimal(65,30)   ,
"cteNumber" integer   ,
"cteKey" text   ,
"dischargeValue" Decimal(65,30)   ,
"receiptValue" Decimal(65,30)   ,
"divergence" "Divergence"  ,
"scheduleId" text   ,
"invoiceFileId" text   ,
"cteFileId" text   ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"canceledAt" timestamp(3)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."files" (
"id" text   NOT NULL ,
"filename" text   NOT NULL ,
"originalname" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."dischargeTable" (
"id" text   NOT NULL ,
"smallPipe" Decimal(65,30)   NOT NULL ,
"mediumPipe" Decimal(65,30)   NOT NULL ,
"largePipe" Decimal(65,30)   NOT NULL ,
"beatPalletizedWithAssistant" Decimal(65,30)   NOT NULL ,
"beatPalletizedWithoutAssistant" Decimal(65,30)   NOT NULL ,
"beatNonPalletizedWithAssistant" Decimal(65,30)   NOT NULL ,
"beatNonPalletizedWithoutAssistant" Decimal(65,30)   NOT NULL ,
"volumePalletizedWithAssistant" Decimal(65,30)   NOT NULL ,
"volumePalletizedWithoutAssistant" Decimal(65,30)   NOT NULL ,
"volumeNonPalletizedWithAssistant" Decimal(65,30)   NOT NULL ,
"volumeNonPalletizedWithoutAssistant" Decimal(65,30)   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "users.email_unique" ON "public"."users"("email")

CREATE UNIQUE INDEX "permissions.title_unique" ON "public"."permissions"("title")

CREATE UNIQUE INDEX "accompaniments_invoiceId_unique" ON "public"."accompaniments"("invoiceId")

CREATE UNIQUE INDEX "cancelations_accompanimentId_unique" ON "public"."cancelations"("accompanimentId")

CREATE UNIQUE INDEX "schedules_schedulesId_unique" ON "public"."schedules"("schedulesId")

CREATE UNIQUE INDEX "schedules_scheduleRequestId_unique" ON "public"."schedules"("scheduleRequestId")

ALTER TABLE "public"."users" ADD FOREIGN KEY ("permissionsId")REFERENCES "public"."permissions"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."accompaniments" ADD FOREIGN KEY ("invoiceId")REFERENCES "public"."invoices"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."accompanimentAnnotations" ADD FOREIGN KEY ("userId")REFERENCES "public"."users"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."accompanimentAnnotations" ADD FOREIGN KEY ("accompanimentId")REFERENCES "public"."accompaniments"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."cancelations" ADD FOREIGN KEY ("accompanimentId")REFERENCES "public"."accompaniments"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."cancelations" ADD FOREIGN KEY ("userId")REFERENCES "public"."users"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."schedules" ADD FOREIGN KEY ("schedulesId")REFERENCES "public"."schedules"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."schedules" ADD FOREIGN KEY ("dischargeTableId")REFERENCES "public"."dischargeTable"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."schedules" ADD FOREIGN KEY ("scheduleRequestId")REFERENCES "public"."scheduleRequests"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."invoices" ADD FOREIGN KEY ("scheduleId")REFERENCES "public"."schedules"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."invoices" ADD FOREIGN KEY ("invoiceFileId")REFERENCES "public"."files"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."invoices" ADD FOREIGN KEY ("cteFileId")REFERENCES "public"."files"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200912115010-initialization
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,276 @@
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+enum Role {
+  USER
+  ADMIN
+}
+
+enum Size {
+  SMALL
+  MEDIUM
+  LARGE
+}
+
+enum Charge {
+  BEAT
+  VOLUME
+  PIPE
+}
+
+enum Receipt {
+  MONEY
+  DEPOSIT
+  PENDING
+}
+
+enum Freight {
+  CIF
+  FOB
+}
+
+enum Vehicle {
+  EXTERNAL
+  INTERNAL
+}
+
+enum Divergence {
+  ADDED
+  RECEIVED
+  NOT_RECEIVED
+  RESCHEDULED
+}
+
+enum InvoiceOrigin {
+  SCHEDULE
+  FOLLOWUP
+}
+
+model Users {
+  @@map(name: "users")
+
+  id            String    @id
+  email         String    @unique
+  name          String
+  password      String
+  role          Role      @default(USER)
+  permissionsId String?
+  createdAt     DateTime  @default(now())
+  updatedAt     DateTime  @updatedAt
+  disabledAt    DateTime?
+
+  permissions  Permissions?               @relation(fields: [permissionsId], references: [id])
+  annotations  AccompanimentAnnotations[]
+  cancelations Cancelations[]
+}
+
+model Permissions {
+  @@map(name: "permissions")
+
+  id                        String    @id
+  title                     String    @unique
+
+  accessSchedules           Boolean   @default(false)
+  createRequest             Boolean   @default(false)
+  createSchedule            Boolean   @default(false)
+  closeSchedule             Boolean   @default(false)
+  manageInvoicesInSchedule  Boolean   @default(false)
+  addExtraScheduledInvoices Boolean   @default(false)
+  receiveSchedule           Boolean   @default(false)
+  cancelSchedule            Boolean   @default(false)
+  rescheduleSchedule        Boolean   @default(false)
+
+  accessAccompaniments      Boolean   @default(false)
+  manageAccompaniments      Boolean   @default(false)
+  accessRepresentatives     Boolean   @default(false)
+
+  viewValues                Boolean   @default(false)
+
+  createdAt                 DateTime  @default(now())
+  updatedAt                 DateTime  @updatedAt
+
+  users Users[]
+}
+
+model Accompaniments {
+  @@map(name: "accompaniments")
+
+  id                String    @id
+  number            Int
+  releasedAt        DateTime?
+  expectedBillingAt DateTime?
+  billingAt         DateTime?
+  freeOnBoardAt     DateTime?
+  schedulingAt      DateTime?
+  valueDelivered    Float?    @default(0.0)
+  invoiceId         String?
+  createdAt         DateTime  @default(now())
+  updatedAt         DateTime  @updatedAt
+
+  annotations AccompanimentAnnotations[]
+  cancelation Cancelations?
+  invoice     Invoices?                  @relation(fields: [invoiceId], references: [id])
+}
+
+model AccompanimentAnnotations {
+  @@map(name: "accompanimentAnnotations")
+
+  id              String   @id
+  content         String
+  createdAt       DateTime @default(now())
+  userId          String
+  accompanimentId String
+
+  user          Users          @relation(fields: [userId], references: [id])
+  accompaniment Accompaniments @relation(fields: [accompanimentId], references: [id])
+}
+
+model Cancelations {
+  @@map(name: "cancelations")
+
+  accompanimentId String   @id
+  motive          String
+  userId          String
+  createdAt       DateTime @default(now())
+
+  accompaniment Accompaniments @relation(fields: [accompanimentId], references: [id])
+  user          Users          @relation(fields: [userId], references: [id])
+}
+
+model Schedules {
+  @@map(name: "schedules")
+
+  id                String    @id
+  dischargeTableId  String
+  scheduleRequestId String?
+
+  scheduledAt       DateTime?
+  priority          Boolean   @default(false)
+  shippingName      String?
+
+  freightType       Freight?
+  vehicleType       Vehicle?
+
+  lecturer          String?
+  driver            String?
+  vehicleSize       Size?
+  chargeType        Charge?
+  palletized        Boolean?
+  assistant         Boolean?
+  pipeSize          Size?
+  receiptPerInvoice Boolean?
+
+  dischargeValue    Float?
+  receiptValue      Float?
+  paymentMethod     Receipt?
+
+  closedAt          DateTime?
+  receivedAt        DateTime?
+
+  rescheduledAt     DateTime?
+
+  createdAt         DateTime  @default(now())
+  updatedAt         DateTime  @updatedAt
+
+  canceledAt        DateTime?
+  motive            String?
+
+  invoices Invoices[]
+
+  rescheduledTo     Schedules? @relation(name: "reschedule")
+  rescheduledFrom   Schedules? @relation(name: "reschedule")
+  dischargeTable    DischargeTable @relation(fields: [dischargeTableId], references: [id])
+  scheduleRequest   ScheduleRequests? @relation(fields: [scheduleRequestId], references: [id])
+}
+
+model ScheduleRequests {
+  @@map(name: "scheduleRequests")
+
+  id            String    @id
+  requestedDate DateTime?
+  providerCode  Int?
+
+  createdAt     DateTime  @default(now())
+  updatedAt     DateTime  @updatedAt
+
+  schedule Schedules?
+}
+
+model Invoices {
+  @@map(name: "invoices")
+
+  id                 String        @id
+  origin             InvoiceOrigin
+
+  providerCode       Int
+  number             Int
+  value              Float?
+
+  emittedAt          DateTime?
+
+  key                String?
+  weight             Float?
+  volume             Float?
+
+  cteNumber          Int?
+  cteKey             String?
+
+  dischargeValue     Float?
+  receiptValue       Float?
+
+  divergence         Divergence?
+
+  scheduleId         String?
+  invoiceFileId      String?
+  cteFileId          String?
+
+  createdAt          DateTime      @default(now())
+  updatedAt          DateTime      @updatedAt
+  canceledAt         DateTime?
+
+  accompaniment  Accompaniments?
+  schedule       Schedules?      @relation(fields: [scheduleId], references: [id])
+  invoiceFile    Files?          @relation(name: "invoice_invoice_file", fields: [invoiceFileId], references: [id])
+  cteFile        Files?          @relation(name: "invoice_cte_file", fields: [cteFileId], references: [id])
+}
+
+model Files {
+  @@map(name: "files")
+
+  id           String @id
+  filename     String
+  originalname String
+
+  invoices Invoices[] @relation(name: "invoice_invoice_file")
+  ctes     Invoices[] @relation(name: "invoice_cte_file")
+}
+
+model DischargeTable {
+  @@map(name: "dischargeTable")
+
+  id String @id
+
+  smallPipe  Float
+  mediumPipe Float
+  largePipe  Float
+
+  beatPalletizedWithAssistant       Float
+  beatPalletizedWithoutAssistant    Float
+  beatNonPalletizedWithAssistant    Float
+  beatNonPalletizedWithoutAssistant Float
+
+  volumePalletizedWithAssistant       Float
+  volumePalletizedWithoutAssistant    Float
+  volumeNonPalletizedWithAssistant    Float
+  volumeNonPalletizedWithoutAssistant Float
+
+  createdAt DateTime @default(now())
+
+  schedules Schedules[]
+}
```


